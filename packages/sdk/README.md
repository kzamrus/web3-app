# @lombard.finance/sdk

The SDK package provides a set of tools to interact with the Lombard Protocol.

It includes API-based and Web3-based methods with which to interact.

Web3 methods require a Web3 provider to be set up.

## Installation

```bash
npm i @lombard.finance/sdk
```

Install Dependencies

```bash
npm i web3@^4 axios@^1 bignumber.js@^9 @bitcoin-js/tiny-secp256k1-asmjs@^2 bitcoinjs-lib@^6
```

## Usage

All methods are documented with JSDoc comments. You can use your IDE's autocomplete feature to see the available methods and their parameters.

### API Methods

- API based
  - [getDepositBtcAddress](#getDepositBtcAddress)
  - [getDepositBtcAddresses](#getDepositBtcAddresses)
  - [generateDepositBtcAddress](#generateDepositBtcAddress)
  - [getDepositsByAddress](#getDepositsByAddress)
  - [getLBTCExchageRate](#getLBTCExchageRate)
- Web3 based
  - [signLbtcDestionationAddr](#signLbtcDestionationAddr)
  - [claimLBTC](#claimLBTC)
  - [unstakeLBTC](#unstakeLBTC)

#### getDepositBtcAddress

`@returns Promise<string>`

Returns the address for depositing BTC.

Parameters:
| name | type | description |
|-----------|----------|--------------------------------------------------------------|
| `address` | `string` | The destination EVM user address where LBTC will be claimed. |
| `chainId` | `TChainId` | The destination chain ID where LBTC will be claimed. |
| `env` | `TEnv` | Environment (optional, default: 'prod') |

Usage

```typescript
import { getDepositBtcAddress } from '@lombard.finance/sdk';
...
const depositBtcAddress = await getDepositBtcAddress({
  address: '0x...',
  chainId: 1,
}); // bc1q...
```

#### getDepositBtcAddresses

`@returns Promise<IDepositAddress[]>`

Returns the addresses for depositing BTC.

Parameters are the same as for `getDepositBtcAddress`.

Probably you will not need this method. You can just use `getDepositBtcAddress`.

#### generateDepositBtcAddress

`@returns {Promise<string>}`

Generates a BTC deposit address.
If the provided EVM address is sanctioned, the function will return the `SANCTIONED_ADDRESS` variable.

Parameters:
| name | type | description |
|-------------|----------|---------------------------------------------------------------------------------------------------|
| `address` | `string` | The destination EVM user address where LBTC will be claimed. |
| `chainId` | `TChainId` | The destination chain ID where LBTC will be claimed. |
| `signature` | `string` | The signature of the address. The signature is generated by signing the address using EVM wallet. |
| `referralId` | `string` | The referral ID. (optional, default: undefined) |
| `env` | `TEnv` | Environment (optional, default: 'prod') |

Usage

```typescript
import { generateDepositBtcAddress } from '@lombard.finance/sdk';
...
const depositBtcAddress = await generateDepositBtcAddress({
  address: '0x...',
  chainId: 1,
  signature: 'SIGNATURE',
}); // bc1q...
```

#### getDepositsByAddress

`@returns Promise<IDeposit[]>`
Returns all deposits for a given address.

Parameters:

| name      | type     | description                             |
| --------- | -------- | --------------------------------------- |
| `address` | `string` | The EVM address to get deposits for     |
| `env`     | `TEnv`   | Environment (optional, default: 'prod') |

Usage

```typescript
import { getDepositsByAddress } from '@lombard.finance/sdk';
...
const deposits = await getDepositsByAddress({
  address: '0x...',
}); // [{...}]
```

#### getLBTCExchageRate

`@returns Promise<number>`

Returns the exchange rate for LBTC.

Parameters:

| name      | type       | description                                            |
| --------- | ---------- | ------------------------------------------------------ |
| `chainId` | `TChainId` | The chain id of the asset to get the exchange rate for |
| `amount`  | `number`   | The amount of the asset to get the exchange rate for   |
| `env`     | `TEnv`     | Environment (optional, default: 'prod')                |

Usage

```typescript
import { getLBTCExchageRate } from '@lombard.finance/sdk';
...
const exchangeRate = await getLBTCExchageRate({
  chainId: 1,
  amount: 3,
}); // 3
```

#### signLbtcDestionationAddr

`@returns Promise<string>` - The signature of the message.

Signs the destination address for the LBTC in active chain in the current account.
Signing is necessary for the generation of the deposit address.

Parameters:

| name       | type               | description                    |
| ---------- | ------------------ | ------------------------------ |
| `provider` | `IEIP1193Provider` | The EIP-1193 provider instance |
| `account`  | `string`           | Current account address        |
| `chainId`  | `TChainId`         | Current chain ID               |

Usage

```typescript
import { signLbtcDestionationAddr } from '@lombard.finance/sdk';
...
// do connect to the wallet using web3.js or ethers.js or any other library
// and get the provider, account and chainId
const destinationAddr = await signLbtcDestionationAddr({
  provider: window.ethereum,
  account: '0x...',
  chainId: 1,
}); // '0x...'
```

#### claimLBTC

`@returns Promise<IWeb3SendResult>` transaction promise

Claims LBTC.

Parameters:

| name             | type               | description                                                                            |
| ---------------- | ------------------ | -------------------------------------------------------------------------------------- |
| `data`           | `string`           | Raw payload from deposit notarization. Can be obtained from the `getDepositsByAddress` |
| `proofSignature` | `string`           | Signature from deposit notarization. Can be obtained from the `getDepositsByAddress`   |
| `provider`       | `IEIP1193Provider` | The EIP-1193 provider instance                                                         |
| `account`        | `string`           | Current account address                                                                |
| `chainId`        | `TChainId`         | Current chain ID                                                                       |
| `env`            | `TEnv`             | Environment (optional, default: 'prod')                                                |

Usage

```typescript
import { claimLBTC } from '@lombard.finance/sdk';
...
// do connect to the wallet using web3.js or ethers.js or any other library
// and get the provider, account and chainId
const { receiptPromise, transactionHash } = await claimLBTC({
  data: 'PAYLOAD',
  proofSignature: 'SIGNATURE',
  provider: window.ethereum,
  account: '0x...',
  chainId: 1,
});
console.log(transactionHash); // '0x...'
const receipt = await receiptPromise; // {...}
```

#### unstakeLBTC

`@returns Promise<IWeb3SendResult>` transaction promise

Unstakes LBTC to the specified BTC address.

Parameters:

| name         | type               | description                                  |
| ------------ | ------------------ | -------------------------------------------- |
| `btcAddress` | `string`           | The BTC address to send the unstaked BTC to. |
| `amount`     | `string`           | The amount of LBTC to unstake.               |
| `provider`   | `IEIP1193Provider` | The EIP-1193 provider instance               |
| `account`    | `string`           | Current account address                      |
| `chainId`    | `TChainId`         | Current chain ID                             |
| `env`        | `TEnv`             | Environment (optional, default: 'prod')      |

Usage

```typescript
import { unstakeLBTC } from '@lombard.finance/sdk';
...
// do connect to the wallet using web3.js or ethers.js or any other library
// and get the provider, account and chainId
const { receiptPromise, transactionHash } = await unstakeLBTC({
  btcAddress: 'bs...',
  amount: 1,
  provider: window.ethereum,
  account: '0x...',
  chainId: 1,
});
console.log(transactionHash); // '0x...'
const receipt = await receiptPromise; // {...}
```

## Development

Available scripts:

- `npm run build` - build the package
- `npm run storybook` - start [storybook](https://storybook.js.org/) for development
- `npm run build-storybook` - build storybook
- `npm run build-docs` - build [Typedoc](https://typedoc.org/) documentation
